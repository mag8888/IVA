# TODO: Django Backend - Что осталось сделать

## ✅ Выполнено

1. ✅ Структура Django проекта
2. ✅ Модели данных (User, Tariff, StructureNode, Payment, Bonus)
3. ✅ MLM логика размещения (BFS алгоритм)
4. ✅ Система бонусов (Green и Yellow)
5. ✅ Django команды (auto_init, create_superuser)
6. ✅ Healthcheck endpoint

## ⏳ В процессе / Следующие шаги

### Этап 3: REST API Endpoints

Нужно создать:

1. **Регистрация партнера** (`/api/register/`)
   - POST запрос с username, email, referral_code, tariff_code
   - Создает User со статусом PARTICIPANT
   - Создает Payment со статусом PENDING
   - Возвращает temporary_password и payment_id

2. **Очередь регистраций** (`/api/queue/`)
   - GET запрос (требует аутентификацию)
   - Возвращает список пользователей с PENDING платежами
   - Информация о пригласившем, тарифе, сумме

3. **Завершение регистрации** (`/api/complete/`)
   - POST запрос с user_id (требует аутентификацию)
   - Меняет статус платежа на COMPLETED
   - Меняет статус пользователя на PARTNER
   - Вызывает place_user() для размещения
   - Вызывает apply_signup_bonuses() для начисления бонусов
   - Возвращает информацию о размещении

4. **Структура MLM** (`/api/structure/`)
   - GET запрос
   - Возвращает дерево структуры
   - Для админ-панели (без аутентификации)

5. **Статус API** (`/api/status/`)
   - ✅ Уже реализован

### Этап 4: Админ-панель

1. **Главная страница** (`/`)
   - Дашборд с статистикой
   - Количество пользователей, партнеров, участников
   - Количество узлов в структуре
   - Количество ожидающих платежей
   - Общая сумма бонусов

2. **Визуализация структуры**
   - Отображение MLM структуры в виде дерева
   - Интерактивная визуализация (через frontend)

3. **Очередь регистраций**
   - Список пользователей, ожидающих оплаты
   - Кнопка завершения регистрации

### Этап 5: Frontend (React)

1. Создать React приложение с Vite
2. Интеграция с API
3. Визуализация структуры
4. Админ-панель

### Этап 6: Telegram Bot

1. Python бот с python-telegram-bot
2. Команды: /start, /app
3. Интеграция с API
4. Мини-приложение

### Этап 7: Docker и Railway

1. Dockerfile
2. start.sh скрипт
3. railway.json конфигурация
4. Переменные окружения

## Вопросы для уточнения

1. Нужны ли миграции сейчас или позже?
2. Какие дополнительные поля нужны в моделях?
3. Нужна ли валидация referral_code при регистрации?
4. Как обрабатывать ошибки размещения?

