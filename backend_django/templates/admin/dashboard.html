{% extends "admin/base_site.html" %}
{% load static %}

{% block extrastyle %}
{{ block.super }}
<style>
    .dashboard-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 20px;
        border-radius: 10px;
        color: white;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s;
    }
    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }
    .stat-card h3 {
        margin: 0 0 10px 0;
        font-size: 14px;
        opacity: 0.9;
    }
    .stat-card .value {
        font-size: 32px;
        font-weight: bold;
        margin: 0;
    }
    .stat-card.green { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
    .stat-card.blue { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .stat-card.orange { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
    .stat-card.purple { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
    
    .dashboard-section {
        background: white;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .dashboard-section h2 {
        margin-top: 0;
        color: #417690;
        border-bottom: 2px solid #417690;
        padding-bottom: 10px;
    }
    .table-responsive {
        overflow-x: auto;
    }
    table {
        width: 100%;
        border-collapse: collapse;
    }
    table th, table td {
        padding: 10px;
        text-align: left;
        border-bottom: 1px solid #ddd;
    }
    table th {
        background: #f8f9fa;
        font-weight: bold;
        color: #417690;
    }
    table tr:hover {
        background: #f8f9fa;
    }
</style>
{% endblock %}

{% block content %}
<h1>üìä Dashboard - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã</h1>

<div class="dashboard-stats">
    <div class="stat-card blue">
        <h3>üë• –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
        <p class="value">{{ total_users }}</p>
    </div>
    <div class="stat-card green">
        <h3>‚úÖ –ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
        <p class="value">{{ active_users }}</p>
    </div>
    <div class="stat-card purple">
        <h3>üí≥ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –æ–ø–ª–∞—Ç–æ–π</h3>
        <p class="value">{{ users_with_payments }}</p>
    </div>
    <div class="stat-card orange">
        <h3>üí∞ –û–±—â–∏–π –¥–æ—Ö–æ–¥</h3>
        <p class="value">${{ total_revenue|floatformat:2 }}</p>
    </div>
</div>

<div class="dashboard-stats">
    <div class="stat-card blue">
        <h3>üìù –í—Å–µ–≥–æ –ø–ª–∞—Ç–µ–∂–µ–π</h3>
        <p class="value">{{ total_payments }}</p>
    </div>
    <div class="stat-card green">
        <h3>‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ</h3>
        <p class="value">{{ completed_payments }}</p>
    </div>
    <div class="stat-card orange">
        <h3>‚è≥ –û–∂–∏–¥–∞–µ—Ç</h3>
        <p class="value">{{ pending_payments }}</p>
    </div>
    <div class="stat-card purple">
        <h3>üéÅ –í—Å–µ–≥–æ –±–æ–Ω—É—Å–æ–≤</h3>
        <p class="value">${{ total_bonuses|floatformat:2 }}</p>
    </div>
</div>

<div class="dashboard-stats">
    <div class="stat-card green">
        <h3>üíö –ó–µ–ª–µ–Ω—ã–µ –±–æ–Ω—É—Å—ã</h3>
        <p class="value">${{ green_bonuses|floatformat:2 }}</p>
    </div>
    <div class="stat-card orange">
        <h3>üíõ –ñ–µ–ª—Ç—ã–µ –±–æ–Ω—É—Å—ã</h3>
        <p class="value">${{ yellow_bonuses|floatformat:2 }}</p>
    </div>
    <div class="stat-card blue">
        <h3>üå≥ –£–∑–ª–æ–≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã</h3>
        <p class="value">{{ total_nodes }}</p>
    </div>
    <div class="stat-card purple">
        <h3>üìà –ó–∞ 30 –¥–Ω–µ–π</h3>
        <p class="value">{{ recent_users }} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
    </div>
</div>

<div class="dashboard-section">
    <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º</h2>
    <div class="table-responsive">
        <table>
            <thead>
                <tr>
                    <th>–¢–∞—Ä–∏—Ñ</th>
                    <th>–ü–ª–∞—Ç–µ–∂–µ–π</th>
                    <th>–û–±—â–∞—è —Å—É–º–º–∞</th>
                </tr>
            </thead>
            <tbody>
                {% for stat in tariffs_stats %}
                <tr>
                    <td><strong>{{ stat.tariff.name }}</strong> (${{ stat.tariff.entry_amount|floatformat:2 }})</td>
                    <td>{{ stat.count }}</td>
                    <td style="color: #28a745; font-weight: bold;">${{ stat.total|floatformat:2 }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="3" style="text-align: center; color: #666;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="dashboard-section">
    <h2>üëë –¢–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –±–∞–ª–∞–Ω—Å—É</h2>
    <div class="table-responsive">
        <table>
            <thead>
                <tr>
                    <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                    <th>Email</th>
                    <th>–ë–∞–ª–∞–Ω—Å</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                </tr>
            </thead>
            <tbody>
                {% for user in top_users_balance %}
                <tr>
                    <td><a href="{% url 'admin:core_user_change' user.id %}">{{ user.username }}</a></td>
                    <td>{{ user.email }}</td>
                    <td style="color: #28a745; font-weight: bold;">${{ user.balance|floatformat:2 }}</td>
                    <td>{{ user.get_status_display }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" style="text-align: center; color: #666;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="dashboard-section">
    <h2>üéÅ –¢–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –±–æ–Ω—É—Å–∞–º</h2>
    <div class="table-responsive">
        <table>
            <thead>
                <tr>
                    <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                    <th>Email</th>
                    <th>–í—Å–µ–≥–æ –±–æ–Ω—É—Å–æ–≤</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                </tr>
            </thead>
            <tbody>
                {% for user in top_users_bonuses %}
                <tr>
                    <td><a href="{% url 'admin:core_user_change' user.id %}">{{ user.username }}</a></td>
                    <td>{{ user.email }}</td>
                    <td style="color: #417690; font-weight: bold;">${{ user.total_bonuses|floatformat:2 }}</td>
                    <td>{{ user.get_status_display }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" style="text-align: center; color: #666;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="dashboard-section">
    <h2>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π</h2>
    <div class="dashboard-stats">
        <div class="stat-card blue">
            <h3>–ù–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
            <p class="value">{{ recent_users }}</p>
        </div>
        <div class="stat-card green">
            <h3>–ù–æ–≤—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π</h3>
            <p class="value">{{ recent_payments }}</p>
        </div>
        <div class="stat-card purple">
            <h3>–î–æ—Ö–æ–¥ –∑–∞ –ø–µ—Ä–∏–æ–¥</h3>
            <p class="value">${{ recent_revenue|floatformat:2 }}</p>
        </div>
    </div>
</div>
{% endblock %}
