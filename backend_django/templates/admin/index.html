{% extends "admin/base_site.html" %}
{% load static %}
{% load admin_urls %}
{% load admin_stats %}

{% block extrastyle %}
  {{ block.super }}
  <link rel="stylesheet" type="text/css" href="{% static 'admin/css/dashboard.css' %}?v=20251116">
{% endblock %}

{% block content %}
  <div class="dashboard-header">
    <h1>üìä –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h1>
    <div class="actions">
      <a class="addlink" href="{% url 'admin:core_user_add' %}">+ –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</a>
      <a class="button" href="{% url 'admin:billing_payment_add' %}">–°–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç—ë–∂</a>
      <a class="button" href="{% url 'admin:billing_bonus_add' %}">–ù–∞—á–∏—Å–ª–∏—Ç—å –±–æ–Ω—É—Å</a>
    </div>
  </div>

  <div class="dashboard-stats">
    <div class="stat-card blue">
      <h3>üë• –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
      <p class="value">{% total_users %}</p>
    </div>
    <div class="stat-card green">
      <h3>‚úÖ –ê–∫—Ç–∏–≤–Ω—ã—Ö</h3>
      <p class="value">{% active_users %}</p>
    </div>
    <div class="stat-card purple">
      <h3>üí≥ –° –æ–ø–ª–∞—Ç–æ–π</h3>
      <p class="value">{% users_with_payments %}</p>
    </div>
    <div class="stat-card orange">
      <h3>üí∞ –í—ã—Ä—É—á–∫–∞</h3>
      <p class="value">${% total_revenue %|floatformat:0 %}</p>
    </div>
  </div>

  <div class="dashboard-stats">
    <div class="stat-card blue">
      <h3>üßæ –ü–ª–∞—Ç–µ–∂–µ–π</h3>
      <p class="value">{% total_payments %}</p>
    </div>
    <div class="stat-card green">
      <h3>–û–ø–ª–∞—á–µ–Ω–æ</h3>
      <p class="value">{% completed_payments %}</p>
    </div>
    <div class="stat-card orange">
      <h3>–û–∂–∏–¥–∞–µ—Ç</h3>
      <p class="value">{% pending_payments %}</p>
    </div>
    <div className="stat-card purple">
      <h3>üéÅ –ë–æ–Ω—É—Å–æ–≤ –≤—Å–µ–≥–æ</h3>
      <p class="value">${% total_bonuses %|floatformat:0 %}</p>
    </div>
  </div>

  <div class="dashboard-stats">
    <div class="stat-card green">
      <h3>üíö –ó–µ–ª–µ–Ω—ã–µ –±–æ–Ω—É—Å—ã</h3>
      <p class="value">${% green_bonuses %|floatformat:0 %}</p>
    </div>
    <div class="stat-card orange">
      <h3>üíõ –ñ–µ–ª—Ç—ã–µ –±–æ–Ω—É—Å—ã</h3>
      <p class="value">${% yellow_bonuses %|floatformat:0 %}</p>
    </div>
    <div class="stat-card blue">
      <h3>üå≥ –£–∑–ª–æ–≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã</h3>
      <p class="value">{% total_nodes %}</p>
    </div>
    <div class="stat-card purple">
      <h3>üìà –ù–æ–≤—ã–µ –∑–∞ 30 –¥–Ω–µ–π</h3>
      <p class="value">{% recent_users 30 %}</p>
    </div>
  </div>

  <div class="dashboard-section">
    <h2>‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
    <div class="quick-grid">
      <a class="quick-card" href="{% url 'admin:core_user_changelist' %}">
        <span>üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span>
        <strong>{% total_users %}</strong>
      </a>
      <a class="quick-card" href="{% url 'admin:billing_payment_changelist' %}">
        <span>üí≥ –ü–ª–∞—Ç–µ–∂–∏</span>
        <strong>{% total_payments %}</strong>
      </a>
      <a class="quick-card" href="{% url 'admin:billing_bonus_changelist' %}">
        <span>üéÅ –ë–æ–Ω—É—Å—ã</span>
        <strong>{% total_bonuses %|floatformat:0 %}</strong>
      </a>
      <a class="quick-card" href="{% url 'admin:mlm_structurenode_changelist' %}">
        <span>üå≥ –°—Ç—Ä—É–∫—Ç—É—Ä–∞</span>
        <strong>{% total_nodes %}</strong>
      </a>
    </div>
  </div>

  <div class="dashboard-columns">
    <div class="dashboard-col">
      <div class="dashboard-section">
        <h2>üèÜ –¢–æ–ø –ø–æ –±–∞–ª–∞–Ω—Å—É</h2>
        <div class="table-responsive">
          <table>
            <thead>
              <tr>
                <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                <th>Email</th>
                <th>–ë–∞–ª–∞–Ω—Å</th>
              </tr>
            </thead>
            <tbody>
              {% top_users_by_balance 5 as tbal %}
              {% if tbal %}
                {% for u in tbal %}
                  <tr>
                    <td><a href="{% url 'admin:core_user_change' u.id %}">{{ u.username }}</a></td>
                    <td>{{ u.email }}</td>
                    <td class="money">${{ u.balance|floatformat:2 }}</td>
                  </tr>
                {% endfor %}
              {% else %}
                <tr><td colspan="3" class="empty-state">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div class="dashboard-col">
      <div class="dashboard-section">
        <h2>üíé –¢–æ–ø –ø–æ –±–æ–Ω—É—Å–∞–º</h2>
        <div class="table-responsive">
          <table>
            <thead>
              <tr>
                <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                <th>Email</th>
                <th>–ë–æ–Ω—É—Å—ã</th>
              </tr>
            </thead>
            <tbody>
              {% top_users_by_bonuses 5 as tbon %}
              {% if tbon %}
                {% for u in tbon %}
                  <tr>
                    <td><a href="{% url 'admin:core_user_change' u.id %}">{{ u.username }}</a></td>
                    <td>{{ u.email }}</td>
                    <td class="money">${{ u.total_bonuses|floatformat:2 }}</td>
                  </tr>
                {% endfor %}
              {% else %}
                <tr><td colspan="3" class="empty-state">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
{% endblock %}


